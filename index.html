<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>üé¨ AI –í–∏–¥–µ–æ</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
  color: #fff;
  padding: 20px;
  min-height: 100vh;
}

.container {
  max-width: 800px;
  margin: 0 auto;
}

h1 {
  text-align: center;
  color: #00ff88;
  margin-bottom: 30px;
  font-size: 2em;
  text-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
}

input {
  width: 100%;
  padding: 15px;
  background: #222;
  border: 2px solid #333;
  border-radius: 12px;
  color: #fff;
  font-size: 16px;
  margin: 15px 0;
  transition: border-color 0.3s;
}

input:focus {
  outline: none;
  border-color: #00ff88;
}

button {
  width: 100%;
  padding: 18px;
  background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
  border: none;
  border-radius: 12px;
  color: #fff;
  font-size: 18px;
  font-weight: 700;
  cursor: pointer;
  margin: 10px 0;
  transition: transform 0.2s, box-shadow 0.2s;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(255, 107, 53, 0.4);
}

button:active {
  transform: translateY(0);
}

button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

.result {
  margin: 20px 0;
  padding: 20px;
  background: rgba(10, 26, 10, 0.6);
  border-radius: 12px;
  border-left: 5px solid #00ff88;
  animation: slideIn 0.3s ease;
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.url-box {
  background: #1a1a1a;
  padding: 10px;
  border-radius: 8px;
  margin: 10px 0;
  font-size: 12px;
  word-break: break-all;
  font-family: 'Courier New', monospace;
  color: #00ff88;
}

.error {
  background: rgba(139, 0, 0, 0.3);
  border-left-color: #ff4444;
}

.loading {
  text-align: center;
  padding: 20px;
  color: #00ff88;
}

.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(0, 255, 136, 0.3);
  border-top-color: #00ff88;
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-right: 10px;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

details {
  margin-top: 10px;
  cursor: pointer;
}

summary {
  padding: 10px;
  background: #2a2a2a;
  border-radius: 8px;
  user-select: none;
}

summary:hover {
  background: #333;
}

img {
  width: 100%;
  border-radius: 12px;
  margin-top: 10px;
  box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
}

.info {
  text-align: center;
  color: #888;
  font-size: 14px;
  margin-top: 20px;
}
</style>
</head>
<body>
<div class="container">
  <h1>üé¨ AI –í–∏–¥–µ–æ –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä</h1>
  
  <input 
    type="password" 
    id="apiKey" 
    placeholder="–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á X.AI (xai-...)"
    autocomplete="off"
  >
  
  <button id="generateBtn" onclick="generate()">
    üöÄ –ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –í–ò–î–ï–û
  </button>
  
  <div id="results"></div>
  
  <div class="info">
    üí° –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Å–æ–∑–¥–∞—Å—Ç –∞–±—Å—É—Ä–¥–Ω—É—é –∏–¥–µ—é –∏ 3 –∫–∞–¥—Ä–∞ –¥–ª—è –≤–∏–¥–µ–æ<br>
    <small style="color: #666; margin-top: 5px; display: block;">
      –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å —Å—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    </small>
  </div>
</div>

<script>
let apiKey = '';
let isGenerating = false;

function showLoading(text) {
  const div = document.createElement('div');
  div.className = 'loading';
  div.innerHTML = `<div class="spinner"></div>${text}`;
  document.getElementById('results').appendChild(div);
  return div;
}

function showError(message) {
  const div = document.createElement('div');
  div.className = 'result error';
  div.innerHTML = `<strong>‚ùå –û—à–∏–±–∫–∞:</strong><br>${message}`;
  document.getElementById('results').appendChild(div);
}

function showResult(title, content) {
  const div = document.createElement('div');
  div.className = 'result';
  div.innerHTML = `<strong>${title}</strong><br>${content}`;
  document.getElementById('results').appendChild(div);
  return div;
}

async function apiChat(prompt) {
  try {
    const response = await fetch('https://api.x.ai/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'grok-beta',
        messages: [{
          role: 'user',
          content: prompt
        }],
        temperature: 0.9,
        max_tokens: 100
      })
    });

    if (!response.ok) {
      const errorText = await response.text();
      let errorMsg = `HTTP ${response.status}`;
      try {
        const errorData = JSON.parse(errorText);
        errorMsg = errorData.error?.message || errorMsg;
      } catch (e) {
        errorMsg = errorText || errorMsg;
      }
      throw new Error(errorMsg);
    }

    const data = await response.json();
    
    if (!data.choices || !data.choices[0] || !data.choices[0].message) {
      throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç API');
    }

    return data.choices[0].message.content;
  } catch (error) {
    if (error.message === 'Failed to fetch') {
      throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
    }
    throw new Error(`–ß–∞—Ç API: ${error.message}`);
  }
}

async function apiImage(prompt) {
  try {
    const response = await fetch('https://api.x.ai/v1/images/generations', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        model: 'grok-2-image-1212',
        prompt: prompt,
        n: 1,
        size: '512x512'
      })
    });

    if (!response.ok) {
      const errorText = await response.text();
      let errorMsg = `HTTP ${response.status}`;
      try {
        const errorData = JSON.parse(errorText);
        errorMsg = errorData.error?.message || errorMsg;
      } catch (e) {
        errorMsg = errorText || errorMsg;
      }
      throw new Error(errorMsg);
    }

    const data = await response.json();
    
    if (!data.data || !data.data[0] || !data.data[0].url) {
      throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç API');
    }

    return data.data[0].url;
  } catch (error) {
    if (error.message === 'Failed to fetch') {
      throw new Error('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É');
    }
    throw new Error(`Image API: ${error.message}`);
  }
}

async function generate() {
  if (isGenerating) return;
  
  apiKey = document.getElementById('apiKey').value.trim();
  
  if (!apiKey) {
    document.getElementById('results').innerHTML = '';
    showError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á!');
    return;
  }
  
  if (!apiKey.startsWith('xai-')) {
    document.getElementById('results').innerHTML = '';
    showError('API –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å "xai-"');
    return;
  }

  isGenerating = true;
  document.getElementById('generateBtn').disabled = true;
  document.getElementById('results').innerHTML = '';

  try {
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–¥–µ–∏
    const loadingIdea = showLoading('–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∏–¥–µ—é...');
    const idea = await apiChat('–ü—Ä–∏–¥—É–º–∞–π –æ–¥–Ω—É –∞–±—Å—É—Ä–¥–Ω—É—é –∏ —Å–º–µ—à–Ω—É—é –∏–¥–µ—é –¥–ª—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ 5-—Å–µ–∫—É–Ω–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ. –ù–∞–ø–∏—à–∏ —Ç–æ–ª—å–∫–æ —Å–∞–º—É –∏–¥–µ—é, –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ. –ë—É–¥—å –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–º –∏ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º!');
    loadingIdea.remove();
    
    showResult('üé¨ –ò–¥–µ—è –≤–∏–¥–µ–æ:', idea);

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –∫–∞–¥—Ä–æ–≤
    for (let i = 1; i <= 3; i++) {
      const loadingFrame = showLoading(`–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–∞–¥—Ä ${i}/3...`);
      
      try {
        const imagePrompt = `${idea}. Frame ${i} of 3, cinematic shot, high quality, detailed`;
        const url = await apiImage(imagePrompt);
        loadingFrame.remove();
        
        const frameDiv = showResult(
          `üñºÔ∏è –ö–∞–¥—Ä ${i}:`,
          `<div class="url-box">${url}</div>
           <details>
             <summary>üëÅÔ∏è –ü–æ–∫–∞–∑–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</summary>
             <img src="${url}" alt="–ö–∞–¥—Ä ${i}" onerror="this.parentElement.innerHTML='<p style=color:#ff4444>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</p>'">
           </details>`
        );
      } catch (error) {
        loadingFrame.remove();
        showError(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–∞–¥—Ä–∞ ${i}: ${error.message}`);
      }

      // –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
      if (i < 3) {
        await new Promise(resolve => setTimeout(resolve, 1000));
      }
    }

    showResult('‚úÖ –ì–æ—Ç–æ–≤–æ!', '–í—Å–µ –∫–∞–¥—Ä—ã —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã');

  } catch (error) {
    showError(error.message);
  } finally {
    isGenerating = false;
    document.getElementById('generateBtn').disabled = false;
  }
}

// –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
document.getElementById('apiKey').addEventListener('keypress', (e) => {
  if (e.key === 'Enter' && !isGenerating) {
    generate();
  }
});
</script>
</body>
</html>